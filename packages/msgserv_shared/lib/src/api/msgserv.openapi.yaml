openapi: 3.0.0
info:
  title: MsgServ
  description: Never mind.
  version: 1.0.0
  x-dart-name: MsgServBackend
  contact:
    url: 'https://blubb.com/'
    email: h@poul.at
    name: Herbert Poul
servers:
  - url: https
paths:
  /check:
    get:
      summary: Health check.
      security: []
      responses:
        '200':
          description: Everything OK
          content:
            application/json:
              schema:
                properties:
                  dbVersion:
                    type: integer
      description: Health check of endpoint data
  /event:
    post:
      summary: Report event, or fetch config.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Event'
      responses:
        '200':
          description: Configuration update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageConfig'
components:
  schemas:
    Event:
      properties:
        ts:
          type: string
          format: date-time
          description: 'Timestamp of the event'
        context:
          type: object
          additionalProperties: true
      required:
        - ts
        - context
    MessageConfig:
      properties:
        messages:
          type: array
          items:
            properties:
              type:
                type: string
              dialog:
                $ref: '#/components/schemas/MessageBanner'
              survey:
                $ref: '#/components/schemas/MessageSurvey'
      required:
        - messages
    Message:
      properties:
        uuid:
          description: Globally unique ID.
          type: string
          format: uuid
        key:
          description: Unique, user friendly key for this message.
          type: string
        body:
          type: string
        expression:
          description: Boolean expression which evaluates whether this message should be shown.
          type: string
        campaign:
          $ref: '#/components/schemas/Campaign'
        actions:
          type: array
          items:
            $ref: '#/components/schemas/MessageAction'
      required:
        - uuid
        - key
        - body
        - expression
        - actions
    MessageBanner:
      allOf:
        - $ref: '#/components/schemas/Message'
      properties:
        title:
          type: string
    MessageSurvey:
      allOf:
        - $ref: '#/components/schemas/Message'
      properties:
        question:
          type: string

    MessageAction:
      properties:
        key:
          type: string
        label:
          type: string
        actionExpression:
          description: Expression which is evaluated when the action is activted/pressed.
          type: string
      required:
        - key
        - label
        - actionExpression
    Campaign:
      properties:
        state:
          type: object
          additionalProperties: true
      required:
        - state
  securitySchemes:
    apiKey:
      type: apiKey
      in: header
      name: X-API-KEY
security:
  - apiKey: []
